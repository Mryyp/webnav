import{z as V,S as fe,a2 as S,V as G,d as R,B as U,a3 as M,a7 as $,i as E,R as O,a4 as ae,ao as ve,N as le,b as d,Q as se,L as N,Y as he,X as ge,a1 as be,ap as pe,m as z,aq as j,O as W,a5 as X,W as Oe,E as Te,x as xe,c as ye,H as ke,ah as _e,f as J,ai as Ce,o as Ee}from"./index-5ee6b2fa.js";import{u as Se,a as ce}from"./index-5786f0c1.js";import{L as Pe}from"./use-id-28ca1a2a.js";import{H as Z,B as we,_ as Ie}from"./_plugin-vue_export-helper-a2c4d23b.js";const[He,b,ee]=V("picker"),ie=e=>e.find(a=>!a.disabled)||e[0];function Be(e,a){const o=e[0];if(o){if(Array.isArray(o))return"multiple";if(a.children in o)return"cascade"}return"default"}function D(e,a){a=G(a,0,e.length);for(let o=a;o<e.length;o++)if(!e[o].disabled)return o;for(let o=a-1;o>=0;o--)if(!e[o].disabled)return o;return 0}const te=(e,a,o)=>a!==void 0&&!!e.find(i=>i[o.value]===a);function Q(e,a,o){const i=e.findIndex(m=>m[o.value]===a),s=D(e,i);return e[s]}function Me(e,a,o){const i=[];let s={[a.children]:e},m=0;for(;s&&s[a.children];){const v=s[a.children],h=o.value[m];if(s=fe(h)?Q(v,h,a):void 0,!s&&v.length){const u=ie(v)[a.value];s=Q(v,u,a)}m++,i.push(v)}return i}function Ne(e){const{transform:a}=window.getComputedStyle(e),o=a.slice(7,a.length-1).split(", ")[5];return Number(o)}function De(e){return S({text:"text",value:"value",children:"children"},e)}const ne=200,oe=300,$e=15,[ue,q]=V("picker-column"),re=Symbol(ue);var Ve=R({name:ue,props:{value:U,fields:M(Object),options:$(),readonly:Boolean,allowHtml:Boolean,optionHeight:M(Number),swipeDuration:M(U),visibleOptionNum:M(U)},emits:["change","clickOption","scrollInto"],setup(e,{emit:a,slots:o}){let i,s,m,v,h;const u=E(),T=E(),r=E(0),f=E(0),y=Se(),k=()=>e.options.length,H=()=>e.optionHeight*(+e.visibleOptionNum-1)/2,x=c=>{let t=D(e.options,c);const n=-t*e.optionHeight,l=()=>{t>k()-1&&(t=D(e.options,c));const p=e.options[t][e.fields.value];p!==e.value&&a("change",p)};i&&n!==r.value?h=l:l(),r.value=n},g=()=>e.readonly||!e.options.length,L=c=>{i||g()||(h=null,f.value=ne,x(c),a("clickOption",e.options[c]))},_=c=>G(Math.round(-c/e.optionHeight),0,k()-1),B=O(()=>_(r.value)),Y=(c,t)=>{const n=Math.abs(c/t);c=r.value+n/.003*(c<0?-1:1);const l=_(c);f.value=+e.swipeDuration,x(l)},P=()=>{i=!1,f.value=0,h&&(h(),h=null)},F=c=>{if(!g()){if(y.start(c),i){const t=Ne(T.value);r.value=Math.min(0,t-H())}f.value=0,s=r.value,m=Date.now(),v=s,h=null}},K=c=>{if(g())return;y.move(c),y.isVertical()&&(i=!0,se(c,!0));const t=G(s+y.deltaY.value,-(k()*e.optionHeight),e.optionHeight),n=_(t);n!==B.value&&a("scrollInto",e.options[n]),r.value=t;const l=Date.now();l-m>oe&&(m=l,v=t)},w=()=>{if(g())return;const c=r.value-v,t=Date.now()-m;if(t<oe&&Math.abs(c)>$e){Y(c,t);return}const l=_(r.value);f.value=ne,x(l),setTimeout(()=>{i=!1},0)},C=()=>{const c={height:`${e.optionHeight}px`};return e.options.map((t,n)=>{const l=t[e.fields.text],{disabled:p}=t,I=t[e.fields.value],de={role:"button",style:c,tabindex:p?-1:0,class:[q("item",{disabled:p,selected:I===e.value}),t.className],onClick:()=>L(n)},me={class:"van-ellipsis",[e.allowHtml?"innerHTML":"textContent"]:l};return d("li",de,[o.option?o.option(t,n):d("div",me,null)])})};return ae(re),ce({stopMomentum:P}),ve(()=>{const c=i?Math.floor(-r.value/e.optionHeight):e.options.findIndex(l=>l[e.fields.value]===e.value),t=D(e.options,c),n=-t*e.optionHeight;i&&t<c&&P(),r.value=n}),le("touchmove",K,{target:u}),()=>d("div",{ref:u,class:q(),onTouchstartPassive:F,onTouchend:w,onTouchcancel:w},[d("ul",{ref:T,style:{transform:`translate3d(0, ${r.value+H()}px, 0)`,transitionDuration:`${f.value}ms`,transitionProperty:f.value?"all":"none"},class:q("wrapper"),onTransitionend:P},[C()])])}});const[Re]=V("picker-toolbar"),A={title:String,cancelButtonText:String,confirmButtonText:String},Ae=["cancel","confirm","title","toolbar"],Le=Object.keys(A);var Ye=R({name:Re,props:A,emits:["confirm","cancel"],setup(e,{emit:a,slots:o}){const i=()=>{if(o.title)return o.title();if(e.title)return d("div",{class:[b("title"),"van-ellipsis"]},[e.title])},s=()=>a("cancel"),m=()=>a("confirm"),v=()=>{const u=e.cancelButtonText||ee("cancel");return d("button",{type:"button",class:[b("cancel"),Z],onClick:s},[o.cancel?o.cancel():u])},h=()=>{const u=e.confirmButtonText||ee("confirm");return d("button",{type:"button",class:[b("confirm"),Z],onClick:m},[o.confirm?o.confirm():u])};return()=>d("div",{class:b("toolbar")},[o.toolbar?o.toolbar():[v(),i(),h()]])}});const[Fe,Je]=V("picker-group"),Ke=Symbol(Fe);S({tabs:$(),activeTab:N(0),nextStepText:String},A);const Ue=S({loading:Boolean,readonly:Boolean,allowHtml:Boolean,optionHeight:N(44),showToolbar:he,swipeDuration:N(1e3),visibleOptionNum:N(6)},A),ze=S({},Ue,{columns:$(),modelValue:$(),toolbarPosition:ge("top"),columnsFieldNames:Object});var je=R({name:He,props:ze,emits:["confirm","cancel","change","scrollInto","clickOption","update:modelValue"],setup(e,{emit:a,slots:o}){const i=E(),s=E(e.modelValue.slice(0)),{parent:m}=ae(Ke),{children:v,linkChildren:h}=be(re);h();const u=O(()=>De(e.columnsFieldNames)),T=O(()=>pe(e.optionHeight)),r=O(()=>Be(e.columns,u.value)),f=O(()=>{const{columns:t}=e;switch(r.value){case"multiple":return t;case"cascade":return Me(t,u.value,s);default:return[t]}}),y=O(()=>f.value.some(t=>t.length)),k=O(()=>f.value.map((t,n)=>Q(t,s.value[n],u.value))),H=O(()=>f.value.map((t,n)=>t.findIndex(l=>l[u.value.value]===s.value[n]))),x=(t,n)=>{if(s.value[t]!==n){const l=s.value.slice(0);l[t]=n,s.value=l}},g=()=>({selectedValues:s.value.slice(0),selectedOptions:k.value,selectedIndexes:H.value}),L=(t,n)=>{x(n,t),r.value==="cascade"&&s.value.forEach((l,p)=>{const I=f.value[p];te(I,l,u.value)||x(p,I.length?I[0][u.value.value]:void 0)}),W(()=>{a("change",S({columnIndex:n},g()))})},_=(t,n)=>{const l={columnIndex:n,currentOption:t};a("clickOption",S(g(),l)),a("scrollInto",l)},B=()=>{v.forEach(n=>n.stopMomentum());const t=g();return W(()=>{a("confirm",t)}),t},Y=()=>a("cancel",g()),P=()=>f.value.map((t,n)=>d(Ve,{value:s.value[n],fields:u.value,options:t,readonly:e.readonly,allowHtml:e.allowHtml,optionHeight:T.value,swipeDuration:e.swipeDuration,visibleOptionNum:e.visibleOptionNum,onChange:l=>L(l,n),onClickOption:l=>_(l,n),onScrollInto:l=>{a("scrollInto",{currentOption:l,columnIndex:n})}},{option:o.option})),F=t=>{if(y.value){const n={height:`${T.value}px`},l={backgroundSize:`100% ${(t-T.value)/2}px`};return[d("div",{class:b("mask"),style:l},null),d("div",{class:[we,b("frame")],style:n},null)]}},K=()=>{const t=T.value*+e.visibleOptionNum,n={height:`${t}px`};return d("div",{ref:i,class:b("columns"),style:n},[P(),F(t)])},w=()=>{if(e.showToolbar&&!m)return d(Ye,Oe(X(e,Le),{onConfirm:B,onCancel:Y}),X(o,Ae))};z(f,t=>{t.forEach((n,l)=>{n.length&&!te(n,s.value[l],u.value)&&x(l,ie(n)[u.value.value])})},{immediate:!0});let C;return z(()=>e.modelValue,t=>{!j(t,s.value)&&!j(t,C)&&(s.value=t.slice(0),C=t.slice(0))},{deep:!0}),z(s,t=>{j(t,e.modelValue)||(C=t.slice(0),a("update:modelValue",C))},{immediate:!0}),le("touchmove",se,{target:i}),ce({confirm:B,getSelectedOptions:()=>k.value}),()=>{var t,n;return d("div",{class:b()},[e.toolbarPosition==="top"?w():null,e.loading?d(Pe,{class:b("loading")},null):null,(t=o["columns-top"])==null?void 0:t.call(o),K(),(n=o["columns-bottom"])==null?void 0:n.call(o),e.toolbarPosition==="bottom"?w():null])}}});const Ze=Te(je);const qe=R({__name:"index",props:{title:{type:Boolean,default:!1},border:{type:Boolean,default:!0},padding:{default:""}},setup(e){const a=e,{title:o,padding:i}=xe(a);return(s,m)=>(Ee(),ye("div",{class:_e({"label-title":J(o),"label-box":s.border}),style:Ce({padding:J(i)})},[ke(s.$slots,"default",{},void 0,!0)],6))}});const et=Ie(qe,[["__scopeId","data-v-4c4333b2"]]);export{et as L,Ze as P};
