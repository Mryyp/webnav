import{d as le,x as ue,i as k,R as $e,n as ke,c as l,e as o,ai as $,f as e,F as te,I as se,o as s,b as S,g as D,t as I,y as _,p as ae,h as ce,r as re,j as T,w as J,G as _e,s as we,ah as Ie,v as Se,u as We}from"./index-5ee6b2fa.js";import{D as he,_ as ye,T as oe,S as Me,B as De,L as qe}from"./scenes-4d631c1e.js";import{I as fe,_ as ie,N as Ve}from"./_plugin-vue_export-helper-a2c4d23b.js";import{S as Ne}from"./index-33a09d76.js";import{L as pe,P as Te}from"./index-e189e7bf.js";import"./index-6cabca22.js";import{F as Be}from"./index-f26ecc53.js";import{p as ne}from"./project-efbc1a4b.js";import{P as Pe}from"./index-5786f0c1.js";import{s as de,b as ve,c as ge,d as Ee}from"./request-0c3efa69.js";import{D as Fe}from"./dialog-1cd8f37f.js";import{f as Ue}from"./utils-64f0fd18.js";import{a as Ae,S as ze}from"./index-e7df9d00.js";import{I as je}from"./index-7dddaeba.js";import"./index-9f85b7f2.js";import"./index-a68753f1.js";import"./use-route-d0228638.js";import"./use-id-28ca1a2a.js";const Ce=v=>(ae("data-v-45f439ac"),v=v(),ce(),v),Le={class:"inventory"},Je={class:"table"},Ge={class:"header"},He={class:"top"},Ke=["onClick"],Oe={key:0},Qe=["src"],Xe={key:0},Ye={key:0,class:"bbox"},Ze=Ce(()=>o("div",{class:"bname"}," 主要信息： ",-1)),Re={class:"vhtml"},eo={key:1,class:"bbox"},oo=Ce(()=>o("div",{class:"bname"}," 备注说明： ",-1)),to={class:"vhtml"},so=le({__name:"inventory",props:{columns:{}},setup(v){const M=v,{columns:z}=ue(M),n=w=>{w.on=!w.on},y=z.value.map(()=>k(null)),N=w=>B=>{y[w].value=B},r=$e(()=>{const w=y.map(u=>{var W,F,j,G,U;if(u.value){const H=((W=u.value.querySelector(".col1"))==null?void 0:W.clientWidth)||0,Q=((F=u.value.querySelector(".col2"))==null?void 0:F.clientWidth)||0,f=((j=u.value.querySelector(".col3"))==null?void 0:j.clientWidth)||0,d=((G=u.value.querySelector(".col4"))==null?void 0:G.clientWidth)||0,t=((U=u.value.querySelector(".col5"))==null?void 0:U.clientWidth)||0;return[H,Q,f,d,t]}return[0,0]}),B=Math.max(...w.map(([u])=>u)),p=Math.max(...w.map(([,u])=>u)),c=Math.max(...w.map(([,,u])=>u)),P=Math.max(...w.map(([,,,u])=>u)),C=Math.max(...w.map(([,,,,u])=>u)),i=B+p+c+P+C+3;return[B,p,c,P,C,i]}),a=k(!1);return ke(()=>{a.value=!0}),(w,B)=>{const p=fe;return s(),l("div",Le,[o("ul",Je,[o("li",Ge,[o("div",He,[o("div",{ref:"col1",style:$({width:e(a)?`${e(r)[0]/100}rem`:"auto"})}," 产品类别 ",4),o("div",{ref:"col2",style:$({width:e(a)?`${e(r)[1]/100}rem`:"auto"})}," 品牌 ",4),o("div",{ref:"col3",style:$({width:e(a)?`${e(r)[2]/100}rem`:"auto"})}," 缩略图 ",4),o("div",{ref:"col4",style:$({width:e(a)?`${e(r)[3]/100}rem`:"auto"})}," 售价/单位 ",4),o("div",{ref:"col5",style:$({width:e(a)?`${e(r)[4]/100}rem`:"auto"})}," 数量 ",4)])]),(s(!0),l(te,null,se(e(z),(c,P)=>(s(),l("li",{key:P,ref_for:!0,ref:"columnDivs",class:"body"},[o("div",{ref_for:!0,ref:N(P),class:"top",onClick:C=>n(c)},[o("div",{class:"col1",style:$({width:e(a)?`${e(r)[0]/100}rem`:"auto"})},[S(p,{class:"icon",name:c.on?"arrow-up":"arrow-down",size:"0.08rem",color:"#293644"},null,8,["name"]),D(" "+I(c.name),1)],4),o("div",{class:"col2",style:$({width:e(a)?`${e(r)[1]/100}rem`:"auto"})},[c.product.length?(s(),l("span",Oe,I(c.product[0].brand),1)):_("",!0)],4),o("div",{class:"col3",style:$({width:e(a)?`${e(r)[2]/100}rem`:"auto"})},[c.product.length?(s(),l("img",{key:0,class:"shopImg",src:c.product[0].img},null,8,Qe)):_("",!0)],4),o("div",{class:"col4",style:$({width:e(a)?`${e(r)[3]/100}rem`:"auto"})},[c.product.length?(s(),l("span",Xe," ¥"+I(c.product[0].price/100)+"/"+I(c.product[0].unit),1)):_("",!0)],4),o("div",{class:"col5",style:$({width:e(a)?`${e(r)[4]/100}rem`:"auto"})},I(c.num),5)],8,Ke),c.on?(s(),l("div",{key:0,class:"bottom",style:$({width:e(a)?`${e(r)[5]/100}rem`:"100%"})},[c.product.length?(s(),l("div",Ye,[Ze,o("div",Re,I(c.product[0].extra),1)])):_("",!0),c.product.length?(s(),l("div",eo,[oo,o("div",to,I(c.product[0].remark),1)])):_("",!0)],4)):_("",!0)]))),128))])])}}});const no=ie(so,[["__scopeId","data-v-45f439ac"]]),lo="/assets/setting-7357981a.png",ao=v=>(ae("data-v-ab477a50"),v=v(),ce(),v),co={class:"main"},io=ao(()=>o("div",{class:"tips"}," 插入产品 ",-1)),ro={class:"main_main"},uo={class:"footer"},mo={key:1},_o=le({__name:"project",props:{id:{}},emits:["doSth"],setup(v,{expose:M,emit:z}){const n=v,y=k(!1),{id:N}=ue(n),r=re({name:"",type:""}),a=re({name:null,type:null,number:null}),w=k(!1),B={text:"name",value:"id"},p=({selectedOptions:f})=>{var d,t;r.name=(d=f[0])==null?void 0:d.name,a.name=(t=f[0])==null?void 0:t.id,r.type="",a.type=null,w.value=!1,F()},c=k([]),P=async()=>{r.name="",r.type="",a.name=null,a.type=null,a.number=null;const f=await ne.cates({orderId:N.value});f.code===0&&(c.value=f.data)},C=k(!1),i={text:"name",value:"id"},u=({selectedOptions:f})=>{var t,g;r.type=(t=f[0])==null?void 0:t.name,a.type=(g=f[0])==null?void 0:g.id,C.value=!1;const d=W.value.findIndex(V=>V.id===a.type);d!==0&&d!==-1&&W.value.unshift(...W.value.splice(d,1))},W=k([]),F=async()=>{const f=await ne.cateProduct({orderId:N.value,cateId:a.name});f.code===0&&(W.value=f.data,W.value.forEach(d=>{d.pon=!1}))},j=f=>{y.value=!!f},G=[{message:"请选择产品类别",required:!0,key:"name"},{message:"请选择产品品牌",required:!0,key:"type"},{message:"请输入产品数量",required:!0,key:"number"}],U=f=>G.some(t=>t.required&&!f[t.key]?(de(t.message),!0):!1),H=k(!0),Q=async()=>{if(U(a))return;a.number<=0&&de("数量需要 > 0"),a.number>=1e4&&de("数量小于 < 10000");const f=c.value.find(t=>t.id===a.name),d=W.value.find(t=>t.id===a.type);f.on=!1,f.num=Number(a.number),d.pon=!0,f.product=W.value,ve("插入成功"),j(!1),z("doSth",f)};return M({display:j}),(f,d)=>{const t=Be,g=Te,V=Pe;return s(),T(V,{show:e(y),"onUpdate:show":d[10]||(d[10]=h=>_e(y)?y.value=h:null),closeable:"",position:"bottom",round:"","safe-area-inset-bottom":"",onOpen:P},{default:J(()=>[o("div",co,[io,o("div",ro,[S(pe,null,{default:J(()=>[S(t,{modelValue:e(r).name,"onUpdate:modelValue":d[0]||(d[0]=h=>e(r).name=h),"is-link":"",readonly:"",required:"",name:"picker",class:"input",label:"产品类别",placeholder:"请选择产品类别","input-align":"right",onClick:d[1]||(d[1]=h=>w.value=!0)},null,8,["modelValue"])]),_:1}),e(r).name?(s(),T(pe,{key:0},{default:J(()=>[S(t,{modelValue:e(r).type,"onUpdate:modelValue":d[2]||(d[2]=h=>e(r).type=h),"is-link":"",readonly:"",required:"",name:"picker",class:"input",label:"产品品牌",placeholder:"请选择产品品牌","input-align":"right",onClick:d[3]||(d[3]=h=>C.value=!0)},null,8,["modelValue"])]),_:1})):_("",!0),e(r).name&&e(r).type?(s(),T(pe,{key:1},{default:J(()=>[S(t,{modelValue:e(a).number,"onUpdate:modelValue":d[4]||(d[4]=h=>e(a).number=h),modelModifiers:{trim:!0},required:"",maxlength:"20",class:"input",type:"digit",min:1,label:"产品数量",placeholder:"请输入产品数量","input-align":"right"},null,8,["modelValue"])]),_:1})):_("",!0)])]),o("div",uo,[o("div",{onClick:d[5]||(d[5]=h=>j(!1))}," 取消 "),e(H)?(s(),l("div",{key:0,onClick:Q}," 新增 ")):(s(),l("div",mo," 新增中... "))]),S(V,{show:e(w),"onUpdate:show":d[7]||(d[7]=h=>_e(w)?w.value=h:null),position:"bottom"},{default:J(()=>[S(g,{columns:e(c),"columns-field-names":B,onConfirm:p,onCancel:d[6]||(d[6]=h=>w.value=!1)},null,8,["columns"])]),_:1},8,["show"]),S(V,{show:e(C),"onUpdate:show":d[9]||(d[9]=h=>_e(C)?C.value=h:null),position:"bottom"},{default:J(()=>[S(g,{columns:e(W),"columns-field-names":i,onConfirm:u,onCancel:d[8]||(d[8]=h=>C.value=!1)},null,8,["columns"])]),_:1},8,["show"])]),_:1},8,["show"])}}});const po=ie(_o,[["__scopeId","data-v-ab477a50"]]),be=v=>(ae("data-v-bfbbc9fe"),v=v(),ce(),v),ho={class:"inventory"},vo={key:0,class:"table"},yo={class:"header"},fo={class:"top"},go=be(()=>o("div",{class:"col0"}," 操作 ",-1)),$o=["onClick"],ko=be(()=>o("div",{class:"col0"},[o("img",{src:lo})],-1)),wo=["src"],Co={key:0},bo=["src"],xo=["src"],Io=["src"],So={key:0},Wo=["src"],Mo=["onClick"],Do=["src"],qo=["onClick"],Vo=["src"],No=["onClick"],To=["src"],Bo=["onClick"],Po=["src"],Eo=["onClick"],Fo=["src"],Uo=["onClick"],Ao=["src"],zo={class:"cob4_box"},jo=le({__name:"edit",props:{columns:{},id:{}},emits:["click"],setup(v,{emit:M}){const z=v,n=we(),{columns:y}=ue(z),N=()=>{M("click",y.value)},r=t=>{t.on=!t.on},a=y.value.map(()=>k(null)),w=t=>g=>{a[t].value=g},B=$e(()=>{const t=a.map(x=>{var m,K,O,L,Y;if(x.value){const X=((m=x.value.querySelector(".col1"))==null?void 0:m.clientWidth)||0,ee=((K=x.value.querySelector(".col2"))==null?void 0:K.clientWidth)||0,Z=((O=x.value.querySelector(".col3"))==null?void 0:O.clientWidth)||0,me=((L=x.value.querySelector(".col4"))==null?void 0:L.clientWidth)||0,xe=((Y=x.value.querySelector(".col5"))==null?void 0:Y.clientWidth)||0;return[X,ee,Z,me,xe]}return[0,0]}),g=Math.max(...t.map(([x])=>x)),V=Math.max(...t.map(([,x])=>x)),h=Math.max(...t.map(([,,x])=>x)),b=Math.max(...t.map(([,,,x])=>x)),A=Math.max(...t.map(([,,,,x])=>x)),q=g+V+h+b+A;return[g,V,h,b,A,q]}),p=k(!1);ke(()=>{p.value=!0,n.maxColumnWidth=B.value});const c=t=>{if(t>0){const g=y.value.splice(t,1)[0];y.value.splice(t-1,0,g)}},P=t=>{if(t<y.value.length-1){const g=y.value.splice(t,1)[0];y.value.splice(t+1,0,g)}},C=t=>{y.value.splice(t,1)},i=(t,g)=>{t.forEach(h=>{h.pon=h.id===g.id});const V=t.findIndex(h=>h.id===g.id);V!==0&&V!==-1&&t.unshift(...t.splice(V,1))},u=t=>{c(t),N()},W=t=>{P(t),N()},F=t=>{C(t),a.value=n.maxColumnWidth,N()},j=(t,g)=>{i(t,t[g]),N()},G=()=>{N()},U=k([]),H=k(),Q=(t,g)=>{U.value=[t,g],H.value.display(!0)},f=k(!0),d=t=>{if(U.value[1]&&U.value[0]===0)y.value.unshift(t),a.unshift(k(null));else{const g=U.value[1]?U.value[0]:U.value[0]+1;y.value.splice(g,0,t),a.splice(g,0,k(null))}N()};return(t,g)=>{const V=fe,h=Ne;return s(),l("div",ho,[e(f)?(s(),l("ul",vo,[o("li",yo,[o("div",fo,[go,o("div",{class:"col1",style:$({width:e(p)?`${e(n).maxColumnWidth[0]/100}rem`:"auto"})}," 产品类别 ",4),o("div",{class:"col2",style:$({width:e(p)?`${e(n).maxColumnWidth[1]/100}rem`:"auto"})}," 品牌 ",4),o("div",{class:"col3",style:$({width:e(p)?`${e(n).maxColumnWidth[2]/100}rem`:"auto"})}," 缩略图 ",4),o("div",{class:"col4",style:$({width:e(p)?`${e(n).maxColumnWidth[3]/100}rem`:"auto"})}," 售价/单位 ",4),o("div",{class:"col5",style:$({width:e(p)?`${e(n).maxColumnWidth[4]/100}rem`:"auto"})}," 数量 ",4)])]),(s(!0),l(te,null,se(e(y),(b,A)=>(s(),l("li",{key:A,ref_for:!0,ref:"columnDivs",class:"body"},[o("div",{ref_for:!0,ref:w(A),class:"top",onClick:q=>r(b)},[ko,o("div",{class:"col1",style:$({width:e(p)?`${e(n).maxColumnWidth[0]/100}rem`:"auto"})},[D(I(b.name)+" ",1),o("img",{src:b.on?e(n).getImage("home/don.png"):e(n).getImage("home/up.png")},null,8,wo)],4),o("div",{class:"col2",style:$({width:e(p)?`${e(n).maxColumnWidth[1]/100}rem`:"auto"})},[b.product.length?(s(),l("span",Co,I(b.product[0].brand),1)):_("",!0),o("img",{src:b.on?e(n).getImage("home/don.png"):e(n).getImage("home/up.png")},null,8,bo)],4),o("div",{class:"col3",style:$({width:e(p)?`${e(n).maxColumnWidth[2]/100}rem`:"auto"})},[b.product.length?(s(),l("img",{key:0,class:"shopImg",src:b.product[0].img},null,8,xo)):_("",!0),o("img",{src:b.on?e(n).getImage("home/don.png"):e(n).getImage("home/up.png")},null,8,Io)],4),o("div",{class:"col4",style:$({width:e(p)?`${e(n).maxColumnWidth[3]/100}rem`:"auto"})},[b.product.length?(s(),l("span",So," ¥"+I(b.product[0].price/100)+"/"+I(b.product[0].unit),1)):_("",!0)],4),o("div",{class:"col5",style:$({width:e(p)?`${e(n).maxColumnWidth[4]/100}rem`:"auto"})},[D(I(b.num)+" ",1),o("img",{src:b.on?e(n).getImage("home/don.png"):e(n).getImage("home/up.png")},null,8,Wo)],4)],8,$o),b.on?(s(),l("div",{key:0,class:"bottom",style:$({width:e(p)?`${(e(n).maxColumnWidth[5]+42)/100}rem`:"100%"})},[o("div",{class:"cob0",style:$({width:e(p)?`${(e(n).maxColumnWidth[0]+42)/100}rem`:"auto"})},[o("div",{onClick:q=>Q(A,!0)},[o("img",{src:e(n).getImage("home/ct.png")},null,8,Do),D(" 上面插入产品 ")],8,Mo),o("div",{onClick:q=>Q(A,!1)},[o("img",{src:e(n).getImage("home/cb.png")},null,8,Vo),D(" 下面插入产品 ")],8,qo),o("div",{onClick:q=>u(A)},[o("img",{src:e(n).getImage("home/top.png")},null,8,To),D(" 上移一位 ")],8,No),o("div",{onClick:q=>W(A)},[o("img",{src:e(n).getImage("home/bottom.png")},null,8,Po),D(" 上移一位 ")],8,Bo),o("div",{onClick:q=>F(A)},[o("img",{src:e(n).getImage("home/delete.png")},null,8,Fo),D(" 删除 ")],8,Eo)],4),o("div",{class:"cob1",style:$({width:e(p)?`${e(n).maxColumnWidth[1]/100}rem`:"auto"})},[(s(!0),l(te,null,se(b.product,(q,x)=>(s(),l("div",{key:x,class:Ie(q.pon?"nameActive":""),onClick:m=>j(b.product,x)},[o("span",null,I(q.brand),1),q.pon?(s(),T(V,{key:0,name:"success",color:"#4775EB"})):_("",!0)],10,Uo))),128))],4),o("div",{class:"cob2",style:$({width:e(p)?`${e(n).maxColumnWidth[2]/100}rem`:"auto"})},[(s(!0),l(te,null,se(b.product,(q,x)=>(s(),l("div",{key:x},[o("img",{src:q.img},null,8,Ao)]))),128))],4),o("div",{class:"cob3",style:$({width:e(p)?`${e(n).maxColumnWidth[3]/100}rem`:"auto"})},null,4),o("div",{class:"cob4",style:$({width:e(p)?`${e(n).maxColumnWidth[4]/100}rem`:"auto"})},[o("div",zo,[S(h,{modelValue:b.num,"onUpdate:modelValue":q=>b.num=q,class:"van-stepper","disable-input":"",min:"1",max:"999",onChange:G},null,8,["modelValue","onUpdate:modelValue"])])],4)],4)):_("",!0)]))),128))])):_("",!0),t.id?(s(),T(po,{key:1,id:t.id,ref_key:"childProfit",ref:H,onDoSth:d},null,8,["id"])):_("",!0)])}}});const Lo=ie(jo,[["__scopeId","data-v-bfbbc9fe"]]),E=v=>(ae("data-v-4d89091d"),v=v(),ce(),v),Jo={class:"money"},Go=E(()=>o("span",null,"¥",-1)),Ho={key:0,class:"bottom"},Ko=E(()=>o("div",null,[o("span",null,"主要信息：包含设备、运输费用、不含税")],-1)),Oo=E(()=>o("div",null,[o("span",null,"备注说明：所有产品均为原厂正品，智能家居设备支持互联互通、远程控制及场景自动化")],-1)),Qo=[Ko,Oo],Xo={class:"money"},Yo={class:"cost"},Zo={class:"rightBox"},Ro={class:"titlar"},et=E(()=>o("span",null,"¥",-1)),ot=E(()=>o("img",{src:ye},null,-1)),tt=[ot],st={key:0,class:"bottom"},nt=E(()=>o("div",null,[o("span",null,"主要信息：设备总金额 x 20%")],-1)),lt=E(()=>o("div",null,[o("span",null,"备注说明：包含安装所需的辅材、人工、app配置、设备配网、场景调试费用")],-1)),at=[nt,lt],ct={class:"money"},it={class:"cost"},dt={class:"rightBox"},rt={class:"titlar"},ut=E(()=>o("span",null,"¥",-1)),mt=E(()=>o("img",{src:ye},null,-1)),_t=[mt],pt={key:0,class:"bottom"},ht=E(()=>o("div",null,[o("span",null,"主要信息：面积 x 50元/平方")],-1)),vt=E(()=>o("div",null,[o("span",null,"备注说明：根据CAD图纸，提供灯光场景设计，输出灯具点位、选型等图纸清单")],-1)),yt=[ht,vt],ft={class:"money"},gt={style:{color:"#4775EB"}},$t=E(()=>o("span",null,"¥",-1)),kt={key:0,class:"bottom"},wt=E(()=>o("div",null,[o("span",null,"主要信息：含设备、运输、安装、调试")],-1)),Ct=E(()=>o("div",null,[o("span",null,"备注说明：定金50%，主材安装阶段设备进场前支付45%，配网调试当天支付5%。不含税")],-1)),bt=[wt,Ct],xt=le({__name:"money",props:{money:{},edit:{}},emits:["click"],setup(v,{emit:M}){const z=v,{money:n,edit:y}=ue(z),N=()=>{n.value.all_money=n.value.money+n.value.de_money+n.value.design_money,M("click",n.value)},r=k([!1,!1,!1,!1]),a=i=>{r.value[i]=!r.value[i]},w=k(),B=()=>{w.value.display(!0)},p=i=>{n.value.de_money=Number(i),N()},c=k(),P=()=>{c.value.display(!0)},C=i=>{n.value.design_money=Number(i),N()};return(i,u)=>{const W=fe;return s(),l("div",null,[o("div",Jo,[o("div",{class:"cost",onClick:u[0]||(u[0]=F=>a(0))},[o("div",null,[S(W,{name:e(r)[0]?"arrow-up":"arrow-down",size:"0.12rem",color:"#273545"},null,8,["name"]),D(" 智能家居设备总计金额 ")]),o("div",null,[Go,D(I(e(n).money.toFixed(2)),1)])]),e(r)[0]?(s(),l("div",Ho,Qo)):_("",!0)]),o("div",Xo,[o("div",Yo,[o("div",{onClick:u[1]||(u[1]=F=>a(1))},[S(W,{name:e(r)[1]?"arrow-up":"arrow-down",size:"0.12rem",color:"#273545"},null,8,["name"]),D(" 设备安装、配网调试费 ")]),o("div",Zo,[o("div",Ro,[et,D(I(e(n).de_money.toFixed(2)),1)]),e(y)?_("",!0):(s(),l("div",{key:0,class:"showEdit",onClick:B},tt))])]),e(r)[1]?(s(),l("div",st,at)):_("",!0)]),o("div",ct,[o("div",it,[o("div",{onClick:u[2]||(u[2]=F=>a(2))},[S(W,{name:e(r)[2]?"arrow-up":"arrow-down",size:"0.12rem",color:"#273545"},null,8,["name"]),D(" 智能灯光标准设计 ")]),o("div",dt,[o("div",rt,[ut,D(I(e(n).design_money.toFixed(2)),1)]),e(y)?_("",!0):(s(),l("div",{key:0,class:"showEdit",onClick:P},_t))])]),e(r)[2]?(s(),l("div",pt,yt)):_("",!0)]),o("div",ft,[o("div",{class:"cost",onClick:u[3]||(u[3]=F=>a(3))},[o("div",null,[S(W,{name:e(r)[3]?"arrow-up":"arrow-down",size:"0.12rem",color:"#273545"},null,8,["name"]),D(" 总金额 ")]),o("div",gt,[$t,D(I(e(n).all_money.toFixed(2)),1)])]),e(r)[3]?(s(),l("div",kt,bt)):_("",!0)]),e(n)?(s(),T(he,{key:0,ref_key:"childMoneya",ref:w,money:e(n).de_money,type:"de_money",onDoSthMoney:p},null,8,["money"])):_("",!0),e(n)?(s(),T(he,{key:1,ref_key:"childMoneyb",ref:c,money:e(n).design_money,type:"design_money",onDoSthMoney:C},null,8,["money"])):_("",!0)])}}});const It=ie(xt,[["__scopeId","data-v-4d89091d"]]),R=v=>(ae("data-v-2503a53b"),v=v(),ce(),v),St={class:"box"},Wt=["src"],Mt=["src"],Dt=["src"],qt={key:1,class:"main"},Vt={class:"custom-indicator"},Nt={class:"header"},Tt={class:"header_name"},Bt={class:"header_time"},Pt={class:"mainBody"},Et={class:"main_box"},Ft=["src"],Ut={key:4,class:"cost"},At=R(()=>o("div",null,"渠道采购总成本",-1)),zt={key:0},jt=R(()=>o("span",null,"¥",-1)),Lt={key:1},Jt=R(()=>o("span",null,"¥",-1)),Gt={key:6,class:"cost"},Ht=R(()=>o("div",null," 报价整体毛利设置 ",-1)),Kt={class:"rightBox"},Ot={class:"titlar"},Qt=R(()=>o("span",null,"%",-1)),Xt=R(()=>o("img",{src:ye},null,-1)),Yt=[Xt],Zt={class:"footer"},Rt={key:1},es=le({__name:"index",setup(v){var q,x;const M=we(),z=Se(),n=We(),y=(q=z.query)==null?void 0:q.id,N=(x=z.query)==null?void 0:x.type,r=()=>{N==="1"?n.push({path:"/home"}):n.push({path:"/record"})},a=()=>{n.push({path:"/record",query:{type:1,id:y}})},w=()=>{n.push({path:"/home"})},B=k([]),p=re({loadingShow:!1}),c=k({}),P=k({}),C=re({money:0,de_money:0,design_money:0,all_money:0,cost_money:0,profit:0}),i=k(null),u=k([]),W=async()=>{p.loadingShow=!0;const m=await ne.info({id:y});m.code===0&&(B.value=[],B.value.push(m.data.order.img),c.value=m.data.order,C.money=m.data.order.money/100,C.de_money=m.data.order.de_money/100,C.design_money=m.data.order.design_money/100,C.all_money=m.data.order.all_money/100,C.cost_money=m.data.order.cost_money/100,C.profit=m.data.order.profit,i.value={...C},P.value=m.data.style,u.value=JSON.parse(m.data.order.content),u.value.forEach(K=>{K.on=!1,K.product.forEach((O,L)=>{O.pon=L===0})})),p.loadingShow=!1};W();const F=(m,K)=>{let O=0;for(const L of m){const Y=L.product.filter(X=>X.pon).reduce((X,ee)=>X+ee[K]*L.num,0);O+=Y}return O/100},j=()=>{i.value.money=F(u.value,"price"),i.value.de_money=i.value.money*.2,i.value.design_money=c.value.area*50,i.value.all_money=i.value.money+i.value.de_money+i.value.design_money},G=k(!1),U=m=>{G.value=!0,u.value=m,i.value.cost_money=F(m,"costPrice"),j()},H=k(),Q=()=>{H.value.display(!0)},f=m=>{i.value.profit=m,V()},d=m=>{i.value.de_money=m.de_money,i.value.design_money=m.design_money},t=k(!0),g=()=>{t.value=!1},V=async()=>{if(i.value.profit<20||i.value.profit>80){de("报价整体毛利率需 >= 20 并且 <= 80");return}const m={id:y,content:JSON.stringify(u.value),profit:i.value.profit,de_money:Number(i.value.de_money*100).toFixed(0),design_money:Number(i.value.design_money).toFixed(0)};G.value===!1&&delete m.content,C.profit==i.value.profit&&delete m.profit,C.de_money==i.value.de_money&&delete m.de_money,C.design_money==i.value.design_money&&delete m.design_money,console.log(m),ge({message:"保存中...",forbidClick:!0}),(await ne.save(m)).code===0&&(ve("保存成功"),W(),t.value=!0,Ee())},h=k(),b=()=>{h.value.display(!0)},A=async()=>{ge({message:"导出PDF中...",forbidClick:!0,duration:0});const m=await ne.pdf({orderId:y});m.code===0&&(window.open(m.data),ve("导出成功"))};return(m,K)=>{const O=Ve,L=je,Y=ze,X=Ae,ee=De;return s(),l("div",St,[S(O,{class:"nav",title:"详情",fixed:"",placeholder:"","safe-area-inset-top":"","left-arrow":"",onClickLeft:r},{right:J(()=>[o("img",{style:{width:"0.26rem",height:"0.26rem","margin-right":"0.15rem"},src:e(M).getImage("home/excel.png"),onClick:A},null,8,Wt),o("img",{style:{width:"0.26rem",height:"0.26rem","margin-right":"0.15rem"},src:e(M).getImage("home/menus.png"),onClick:a},null,8,Mt),o("img",{style:{width:"0.26rem",height:"0.26rem"},src:e(M).getImage("home/me.png"),onClick:w},null,8,Dt)]),_:1}),e(p).loadingShow?(s(),T(qe,{key:0})):(s(),l("div",qt,[S(X,{class:"banner",autoplay:3e3,"lazy-render":""},{indicator:J(({active:Z,total:me})=>[o("div",Vt,I(Z+1)+"/"+I(me),1)]),default:J(()=>[(s(!0),l(te,null,se(e(B),Z=>(s(),T(Y,{key:Z},{default:J(()=>[S(L,{width:"100%",height:"1.99rem",src:Z},null,8,["src"])]),_:2},1024))),128))]),_:1}),o("div",Nt,[o("div",Tt,I(e(c).name),1),o("div",Bt,[S(L,{width:"0.15rem",height:"0.15rem",src:e(M).getImage("home/time.png")},null,8,["src"]),o("span",null,I(e(Ue)(Number(e(c).add_time),"yyyy-MM-dd",1)),1)])]),o("div",Pt,[o("div",Et,[S(oe,{title:"智能产品清单",font:"0.18rem",padding:"0.27rem 0 0.1rem 0"}),e(t)?(s(),T(no,{key:0,columns:e(u)},null,8,["columns"])):(s(),T(Lo,{key:1,id:e(y),columns:e(u),onClick:U},null,8,["id","columns"])),S(oe,{title:"装修风格",tips:`(${e(P).name})`},null,8,["tips"]),e(c)?(s(),l("iframe",{key:2,class:"ifam",src:e(P).url},null,8,Ft)):_("",!0),S(oe,{title:"价格明细"}),S(It,{money:e(i),edit:e(t),onClick:d},null,8,["money","edit"]),e(M).info_data.show_money===1||e(M).info_data.show_money===0&&!e(t)?(s(),T(oe,{key:3,title:"成本明细",tips:"(分享不可见)"})):_("",!0),e(M).info_data.show_money===1||e(M).info_data.show_money===0&&!e(t)?(s(),l("div",Ut,[At,e(t)?(s(),l("div",zt,[jt,D(I(e(i).cost_money),1)])):(s(),l("div",Lt,[Jt,D(I(e(i).cost_money),1)]))])):_("",!0),e(t)?_("",!0):(s(),T(oe,{key:5,title:"毛利率",tips:"(分享不可见)"})),e(t)?_("",!0):(s(),l("div",Gt,[Ht,o("div",Kt,[o("div",Ot,[D(I(e(i).profit),1),Qt]),e(t)?_("",!0):(s(),l("div",{key:0,class:"showEdit",onClick:Q},Yt))])]))])]),S(ee),e(c).ai_content?(s(),T(Me,{key:0,name:e(c).ai_content},null,8,["name"])):_("",!0),o("div",Zt,[e(M).info_data.level>=1&&e(c).status==1&&e(c).share_code?(s(),l("div",{key:0,onClick:b},"分享")):_("",!0),e(M).info_data.level>1||e(M).info_data.level<=1&&e(c).status==0?(s(),l("div",Rt,[e(t)?(s(),l("div",{key:0,onClick:g}," 编辑 ")):(s(),l("div",{key:1,onClick:V}," 保存 "))])):_("",!0)])])),e(c).share_code?(s(),T(Fe,{key:2,ref_key:"childInvite",ref:h,"invite-code":e(c).share_code,type:1},null,8,["invite-code"])):_("",!0),e(i)?(s(),T(he,{key:3,ref_key:"childMoney",ref:H,money:e(i).profit,type:"profit",onDoSthMoney:f},null,8,["money"])):_("",!0)])}}});const gs=ie(es,[["__scopeId","data-v-2503a53b"]]);export{gs as default};
