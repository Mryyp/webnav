import{ag as Q,ax as q,a2 as z,aD as J,B as b,Y as C,C as B,i,aK as ee,at as L,ad as te,m as g,av as oe,Q as R,z as p,d as N,N as Y,b as h,aL as K,ar as ne,S as M,ae as X,af as F,E as H,X as T,R as ae,O as se,n as le,as as ce,aH as re,au as ie,F as ue,aM as de,W as ve}from"./index-5ee6b2fa.js";import{T as A,P as fe,H as ye,I as he}from"./_plugin-vue_export-helper-a2c4d23b.js";function me(e,{args:t=[],done:o,canceled:l}){if(e){const n=e.apply(null,t);Q(n)?n.then(a=>{a?o():l&&l()}).catch(q):n?o():l&&l()}else o()}function Ie(e){const t=J();t&&z(t.proxy,e)}const $={show:Boolean,zIndex:b,overlay:C,duration:b,teleport:[String,Object],lockScroll:C,lazyRender:C,beforeClose:Function,overlayStyle:Object,overlayClass:B,transitionAppear:Boolean,closeOnClickOverlay:C},De=Object.keys($);function Oe(e,t){return e>t?"horizontal":t>e?"vertical":""}function Ce(){const e=i(0),t=i(0),o=i(0),l=i(0),n=i(0),a=i(0),s=i(""),r=i(!0),P=()=>s.value==="vertical",O=()=>s.value==="horizontal",u=()=>{o.value=0,l.value=0,n.value=0,a.value=0,s.value="",r.value=!0};return{move:d=>{const v=d.touches[0];o.value=(v.clientX<0?0:v.clientX)-e.value,l.value=v.clientY-t.value,n.value=Math.abs(o.value),a.value=Math.abs(l.value);const I=10;(!s.value||n.value<I&&a.value<I)&&(s.value=Oe(n.value,a.value)),r.value&&(n.value>A||a.value>A)&&(r.value=!1)},start:d=>{u(),e.value=d.touches[0].clientX,t.value=d.touches[0].clientY},reset:u,startX:e,startY:t,deltaX:o,deltaY:l,offsetX:n,offsetY:a,direction:s,isVertical:P,isHorizontal:O,isTap:r}}let k=0;const D="van-overflow-hidden";function Pe(e,t){const o=Ce(),l="01",n="10",a=u=>{o.move(u);const m=o.deltaY.value>0?n:l,w=oe(u.target,e.value),{scrollHeight:d,offsetHeight:v,scrollTop:I}=w;let f="11";I===0?f=v>=d?"00":"01":I+v>=d&&(f="10"),f!=="11"&&o.isVertical()&&!(parseInt(f,2)&parseInt(m,2))&&R(u,!0)},s=()=>{document.addEventListener("touchstart",o.start),document.addEventListener("touchmove",a,{passive:!1}),k||document.body.classList.add(D),k++},r=()=>{k&&(document.removeEventListener("touchstart",o.start),document.removeEventListener("touchmove",a),k--,k||document.body.classList.remove(D))},P=()=>t()&&s(),O=()=>t()&&r();ee(P),L(O),te(O),g(t,u=>{u?s():r()})}function j(e){const t=i(!1);return g(e,o=>{o&&(t.value=o)},{immediate:!0}),o=>()=>t.value?o():null}const[ke,we]=p("overlay"),Se={show:Boolean,zIndex:b,duration:b,className:B,lockScroll:C,lazyRender:C,customStyle:Object};var be=N({name:ke,props:Se,setup(e,{slots:t}){const o=i(),l=j(()=>e.show||!e.lazyRender),n=s=>{e.lockScroll&&R(s,!0)},a=l(()=>{var s;const r=z(ne(e.zIndex),e.customStyle);return M(e.duration)&&(r.animationDuration=`${e.duration}s`),X(h("div",{ref:o,style:r,class:[we(),e.className]},[(s=t.default)==null?void 0:s.call(t)]),[[F,e.show]])});return Y("touchmove",n,{target:o}),()=>h(K,{name:"van-fade",appear:!0},{default:a})}});const xe=H(be),Te=z({},$,{round:Boolean,position:T("center"),closeIcon:T("cross"),closeable:Boolean,transition:String,iconPrefix:String,closeOnPopstate:Boolean,closeIconPosition:T("top-right"),safeAreaInsetTop:Boolean,safeAreaInsetBottom:Boolean}),[ze,_]=p("popup");var ge=N({name:ze,inheritAttrs:!1,props:Te,emits:["open","close","opened","closed","keydown","update:show","clickOverlay","clickCloseIcon"],setup(e,{emit:t,attrs:o,slots:l}){let n,a;const s=i(),r=i(),P=j(()=>e.show||!e.lazyRender),O=ae(()=>{const c={zIndex:s.value};if(M(e.duration)){const y=e.position==="center"?"animationDuration":"transitionDuration";c[y]=`${e.duration}s`}return c}),u=()=>{n||(n=!0,s.value=e.zIndex!==void 0?+e.zIndex:de(),t("open"))},m=()=>{n&&me(e.beforeClose,{done(){n=!1,t("close"),t("update:show",!1)}})},w=c=>{t("clickOverlay",c),e.closeOnClickOverlay&&m()},d=()=>{if(e.overlay)return h(xe,{show:e.show,class:e.overlayClass,zIndex:s.value,duration:e.duration,customStyle:e.overlayStyle,role:e.closeOnClickOverlay?"button":void 0,tabindex:e.closeOnClickOverlay?0:void 0,onClick:w},{default:l["overlay-content"]})},v=c=>{t("clickCloseIcon",c),m()},I=()=>{if(e.closeable)return h(he,{role:"button",tabindex:0,name:e.closeIcon,class:[_("close-icon",e.closeIconPosition),ye],classPrefix:e.iconPrefix,onClick:v},null)};let f;const V=()=>{f&&clearTimeout(f),f=setTimeout(()=>{t("opened")})},G=()=>t("closed"),U=c=>t("keydown",c),W=P(()=>{var c;const{round:y,position:S,safeAreaInsetTop:x,safeAreaInsetBottom:Z}=e;return X(h("div",ve({ref:r,style:O.value,role:"dialog",tabindex:0,class:[_({round:y,[S]:S}),{"van-safe-area-top":x,"van-safe-area-bottom":Z}],onKeydown:U},o),[(c=l.default)==null?void 0:c.call(l),I()]),[[F,e.show]])}),E=()=>{const{position:c,transition:y,transitionAppear:S}=e,x=c==="center"?"van-fade":`van-popup-slide-${c}`;return h(K,{name:y||x,appear:S,onAfterEnter:V,onAfterLeave:G},{default:W})};return g(()=>e.show,c=>{c&&!n&&(u(),o.tabindex===0&&se(()=>{var y;(y=r.value)==null||y.focus()})),!c&&n&&(n=!1,t("close"))}),Ie({popupRef:r}),Pe(r,()=>e.show&&e.lockScroll),Y("popstate",()=>{e.closeOnPopstate&&(m(),a=!1)}),le(()=>{e.show&&u()}),ce(()=>{a&&(t("update:show",!0),a=!1)}),L(()=>{e.show&&e.teleport&&(m(),a=!0)}),re(fe,()=>e.show),()=>e.teleport?h(ie,{to:e.teleport},{default:()=>[d(),E()]}):h(ue,null,[d(),E()])}});const _e=H(ge);export{_e as P,Ie as a,De as b,me as c,$ as p,Ce as u};
